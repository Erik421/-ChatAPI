# Chats & Messages API

Тестовое задание: REST API для чатов и сообщений.

Проект реализует простую систему чатов с возможностью отправки сообщений, получения последних сообщений и каскадного удаления данных.


## Стек

* Python 3.11
* FastAPI
* SQLAlchemy 2.0 (ORM)
* PostgreSQL
* Alembic (миграции)
* Docker / docker-compose
* Pytest (опционально)


## Функциональность

### Модели

* **Chat**

  * `id`
  * `title` (1..200, trim)
  * `created_at`

* **Message**

  * `id`
  * `chat_id` (FK → Chat)
  * `text` (1..5000)
  * `created_at`

Связь: **Chat 1 — N Message** (каскадное удаление).


## API

### POST /chats/

Создать чат

{ "title": "My chat" }

### POST /chats/{id}/messages/

Отправить сообщение в чат

{ "text": "Hello" }

### GET /chats/{id}?limit=20

Получить чат и последние сообщения (по умолчанию 20, максимум 100).

### DELETE /chats/{id}

Удалить чат вместе со всеми сообщениями.


## Валидация и ограничения

* Нельзя отправить сообщение в несуществующий чат (404)
* `title` и `text` не могут быть пустыми
* Пробелы по краям строк автоматически удаляются
* Сообщения сортируются по `created_at`


## Запуск проекта

docker-compose up --build

Применение миграций:

docker-compose exec api alembic upgrade head

API будет доступно по адресу:

http://localhost:8000

Swagger:

http://localhost:8000/docs


## Тестирование

Проект покрыт базовыми автотестами с использованием **pytest** и **FastAPI TestClient**.

Тесты проверяют:

* создание чата
* валидацию входных данных
* отправку сообщений
* обработку несуществующих чатов (404)
* работу параметра `limit`
* каскадное удаление сообщений при удалении чата

Для тестов используется отдельная SQLite-база данных.

Запуск тестов:

python -m pytest
